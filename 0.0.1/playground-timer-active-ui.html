<!DOCTYPE html>
<!-- one.upload https://u1.linnk.it/qc8sbw/usr/apps/textsync/docs/bootstrap-playground -->
<!DOCTYPE html>
<html>

<meta name="viewport" content="width=device-width, initial-scale=1.0">
<head>


<style type="text/css">

/*footer.container.navbar-fixed-top {
	top: auto;
	bottom: 0;
}*/
</style>

<link
	href="http://appjangle.com/assets/v02/bootstrap-2.1.0/css/bootstrap.min.css"
	rel="stylesheet">
<link
	href="http://appjangle.com/assets/v02/bootstrap-2.1.0/css/bootstrap-responsive.min.css"
	rel="stylesheet">

<script
	src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>

<script
	src="http://appjangle.com/assets/v02/bootstrap-2.1.0/js/bootstrap.min.js"></script>

</head>

<script>
	(function($) {

		$.initTimeReporterUi = function(params) {

			var elem = params.elem;

			if (elem.length <= 0)
				throw "Please define valid element";

			var tr = {};

			tr.startDate = null;
			tr.minutesPaused = null;
			tr.minutesWorked = null;
			tr.endDate = null;
			tr.timer = null;
			tr.onFinalized = null;
			tr.pauseStart = null;

			tr.show = function(onFinalized) {
				tr.onFinalized = onFinalized;
				tr.startDate = new Date();
				tr.minutesPaused = 0.0;
				tr.endData = null;
				tr.minutesWorked = 0.0;

				$('.timerDetails', elem).hide();
				
				$('.startTime', elem).html(new Date() + " ");

				$('.pausedTime', elem).html("00:00:00");

				$('.pauseNow', elem).removeAttr('disabled');
				$('.unpause', elem).attr('disabled', 'disabled');

				$('.minutesWorked', elem).html("0.00");

				$('.unitsWorked', elem).html("0.00");

				$('.activities', elem).val(" ");

				$('.project', elem).val("1");

			};

			tr.start = function() {
				$('.timerDetails', elem).fadeIn('fast');
				tr.priv.startTimer();
			};

			tr.finalize = function() {
				tr.priv.stopTimer();

				res = {
					startDate : tr.startDate,
					endDate : new Date(),
					minutesWorked : tr.minutesWorked,
					activities : $('.activites', elem).val(),
					project : $('.project', elem).val()
				};

				tr.onFinalized(res);

			}

			tr.priv = {};

			tr.priv.startTimer = function() {
				if (tr.timer) {
					return;
				}

				tr.timer = setInterval(function() {
					if (tr.startDate) {
						var minutesPaused;
						if (!tr.pauseStart) {
							minutesPaused = tr.minutesPaused;
						} else {
							minutesPaused = tr.minutesPaused
									+ (new Date().getTime() - tr.pauseStart
											.getTime()) / (1000 * 60);
						}
						var minutes = (new Date().getTime() - tr.startDate
								.getTime())
								/ (1000 * 60) - minutesPaused;
						var units = minutes / 30;

						tr.minutesWorked = minutes;

						var minutesTxt = minutes + " ";
						var pausedTxt = minutesPaused + " ";
						if (minutesPaused === 0) {
							 pausedTxt = "0.00";
						}
						var unitsTxt = units + " ";
						$('.minutesWorked', elem).html(
								minutesTxt.substring(0, 5));
						$('.pausedTime', elem).html(pausedTxt.substring(0, 5));
						$('.unitsWorked', elem).html(unitsTxt.substring(0, 5));
					}
				}, 1000);
			};

			tr.priv.stopTimer = function() {
				clearInterval(tr.timer);
				tr.timer = null;
			};

			// init Ui

			$('.startButton', elem).click(function(evt) {
				evt.preventDefault();
				tr.start();
				$('.startButton', elem).attr('disabled', 'disabled');
			});

			$('.pauseNow', elem).click(function(evt) {
				evt.preventDefault();
				tr.pauseStart = new Date();
				$('.unpause', elem).removeAttr('disabled');
				$('.pauseNow', elem).attr('disabled', 'disabled');
			});

			$('.unpause', elem).click(
					function(evt) {
						evt.preventDefault();
						tr.minutesPaused = tr.minutesPaused
								+ (new Date().getTime() - tr.pauseStart
										.getTime()) / (1000 * 60);
						tr.pauseStart = null;
						$('.pauseNow', elem).removeAttr('disabled');
						$('.unpause', elem).attr('disabled', 'disabled');
					});

			$('.finalizeButton', elem).click(function(evt) {
				evt.preventDefault();
				tr.finalize();
				$('.finalizeButton', elem).attr('disabled', 'disabled');
			});

			return {
				show : tr.show,
				start : tr.start,
				finalize : tr.finalize
			};
		};

	})(jQuery);

	window.onload = function() {
		var tr = $.initTimeReporterUi({
			elem : $('#timeReporterUi')
		});

		tr.show(function(res) {
			alert(JSON.stringify(res));
		});
	};
</script>

<body>

	<div id="timeReporterUi">



		<div class="container-fluid" style="background-color: white">
			<div class="row-fluid">
				<div class="span12">
					<button class="startButton btn btn-success btn-large btn-block"
						type="button">Start Work Unit</button>
				</div>
			</div>
			<div class="timerDetails" style="display:none;">
				<div class="row-fluid" style="margin-top: 30px;">

					<form class="form-horizontal">

						<div class="control-group">
							<label class="control-label" for="startTime">Start Time</label>
							<div class="controls">
								<span class="startTime input-xlarge uneditable-input"
									style="width: 100%" id="startTime">12:23:23</span>
							</div>
						</div>

						<div class="control-group">
							<label class="control-label" for="pausedTime">Paused</label>
							<div class="controls">
								<span class="pausedTime input-xlarge uneditable-input"
									style="width: 100%" id="pausedTime">00:00:00</span>
							</div>
						</div>
						<div class="control-group">

							<div class="controls">
								<div class="btn-group pull-right">
									<button class="pauseNow btn btn-mini">Pause Now</button>
									<button class="unpause btn btn-mini" disabled>Unpause</button>
								</div>
							</div>
						</div>
						<div class="control-group">
							<label class="control-label" for="minutesWorked">Minutes
								Worked</label>
							<div class="controls">
								<span class="minutesWorked input-xlarge uneditable-input"
									style="width: 100%" id="minutesWorked">7.5</span>
							</div>
						</div>
						<div class="control-group">
							<label class="control-label" for="unitsWorked">Units
								Worked</label>
							<div class="controls">
								<span class="unitsWorked input-xlarge uneditable-input"
									style="width: 100%" id="unitsWorked">0.25</span>
							</div>
						</div>
						<div class="control-group">
							<label class="control-label" for="activities">Activities</label>
							<div class="controls" id="activities">
								<textarea class="activities" style="width: 100%" rows="7"></textarea>
							</div>
						</div>
						<div class="control-group">
							<label class="control-label" for="startTime">Project</label>
							<div class="controls">
								<input class="project input-xlarge" type="text"
									placeholder="Project name" style="width: 100%">

							</div>
						</div>
					</form>
				</div>

				<div class="row-fluid">
					<div class="span12">
						<button class="finalizeButton btn btn-danger btn-large btn-block"
							type="button">Finalize Work Unit</button>
					</div>
				</div>
			</div>

		</div>





	</div>







</body>

</html>
<!-- one.end -->
